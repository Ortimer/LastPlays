/*!Tue Apr 07 2015 10:55:38 */
window.BggBuddy=Ember.Application.create({}),BggBuddy.ApplicationAdapter=DS.RESTAdapter.extend({}),BggBuddy.ApplicationController=Ember.Controller.extend({}),BggBuddy.IndexLastplaysController=Ember.Controller.extend({orderByArray:["Name","Days","Total plays"],orderByIndex:0,orderBy:function(){return this.get("orderByArray")[this.get("orderByIndex")]}.property("orderByIndex"),orderTypeArray:["Ascending","Descending"],orderTypeIndex:0,orderType:function(){return this.get("orderTypeArray")[this.get("orderTypeIndex")]}.property("orderTypeIndex"),actions:{changeOrderBy:function(){var orderByIndex=this.get("orderByIndex")+1;orderByIndex>=this.get("orderByArray").length&&(orderByIndex=0),this.set("orderByIndex",orderByIndex),this.get("model").get("games").sortBy("id")},changeOrderType:function(){var orderTypeIndex=this.get("orderTypeIndex")+1;orderTypeIndex>=this.get("orderTypeArray").length&&(orderTypeIndex=0),this.set("orderTypeIndex",orderTypeIndex)}}}),Ember.Handlebars.helper("formatdate",function(value){var escaped=Handlebars.Utils.escapeExpression(value),formatedDate=moment(new Date(escaped)).format("DD-MMM-YYYY");return new Ember.Handlebars.SafeString(formatedDate)}),BggBuddy.BggUser=DS.Model.extend({firstName:DS.attr("string"),lastName:DS.attr("string"),avatarLink:DS.attr("string")}),BggBuddy.Collection=DS.Model.extend({games:DS.hasMany("game")}),BggBuddy.Game=DS.Model.extend({collection_id:DS.belongsTo("collection"),bggUrl:DS.attr("string"),name:DS.attr("string"),image:DS.attr("string"),totalPlays:DS.attr("string"),lastPlay:DS.belongsTo("play",{async:!0}),lastPlayMillis:function(){var now=moment(),then=moment(new Date(this.get("lastPlay.date"))),ms=then.diff(now,"milliseconds",!0);return ms}.property("lastPlay"),lastPlayText:function(){var now=moment(),then=moment(new Date(this.get("lastPlay.date"))),ms=then.diff(now,"milliseconds",!0),years=Math.floor(moment.duration(ms).asYears());then=then.subtract(years,"years"),ms=then.diff(now,"milliseconds",!0);var months=Math.floor(moment.duration(ms).asMonths());then=then.subtract(months,"months").subtract(1,"days"),ms=then.diff(now,"milliseconds",!0),days=Math.floor(moment.duration(ms).asDays());var result="";return years>0&&(result+=years+" year(s) "),months>0&&(result+=months+" month(s) "),days>0&&(result+=days+" day(s) "),result.trim()}.property("lastPlay")}),BggBuddy.Play=DS.Model.extend({game_id:DS.belongsTo("game"),date:DS.attr("date"),location:DS.attr("string")}),BggBuddy.Menu=DS.Model.extend({messages:DS.hasMany("menuMessage"),tasks:DS.hasMany("menuTask"),sideMenuOptions:DS.hasMany("menuSideOption")}),BggBuddy.MenuMessage=DS.Model.extend({author:DS.attr("string"),time:DS.attr("string"),message:DS.attr("string")}),BggBuddy.MenuTask=DS.Model.extend({name:DS.attr("string"),progress:DS.attr("number"),barType:DS.attr("string")}),BggBuddy.MenuSideOption=DS.Model.extend({name:DS.attr("string"),icon:DS.attr("string"),link:DS.attr("string"),subMenus:DS.hasMany("menuSideSub")}),BggBuddy.MenuSideSub=DS.Model.extend({name:DS.attr("string"),link:DS.attr("string")}),BggBuddy.Router.map(function(){this.resource("root",{path:"/"}),this.resource("index",{path:"/:bggUser"},function(){this.route("lastplays",{path:"lastplays"})})}),BggBuddy.ApplicationRoute=Ember.Route.extend({model:function(){return this.store.find("menu",1)}}),BggBuddy.IndexLastplaysRoute=Ember.Route.extend({model:function(){var bggUser=this.modelFor("index");return this.store.find("collection",bggUser.get("id"))}}),BggBuddy.IndexRoute=Ember.Route.extend({model:function(params){return this.store.find("bggUser",params.bggUser)},afterModel:function(bggUser){this.transitionTo(null!=bggUser?"index.lastplays":"root")}}),BggBuddy.CollectionSerializer=DS.RESTSerializer.extend(DS.EmbeddedRecordsMixin,{attrs:{games:{embedded:"always"}}}),BggBuddy.MenuSerializer=DS.RESTSerializer.extend(DS.EmbeddedRecordsMixin,{attrs:{messages:{embedded:"always"},tasks:{embedded:"always"},sideMenuOptions:{embedded:"always"}}}),BggBuddy.MenuSideOptionSerializer=DS.RESTSerializer.extend(DS.EmbeddedRecordsMixin,{attrs:{subMenus:{embedded:"always"}}}),Ember.View.reopen({didInsertElement:function(){this._super(),Ember.run.scheduleOnce("afterRender",this,this.afterRenderEvent)},afterRenderEvent:function(){}}),BggBuddy.ApplicationView=Ember.View.extend({afterRenderEvent:function(){$(function(){function calvoInit(){locked||(locked=!0,calvo.animate({bottom:"0"},function(){$(this).animate({bottom:"-30px"},100,function(){var offset=$(this).position().left+700;$(this).delay(300).animate({right:offset},3500,function(){calvo=$("#elCalvo").css({bottom:"-700px",right:"0"}),locked=!1})})}))}var calvo=(new Konami(calvoInit),$("#elCalvo").css({position:"fixed",bottom:"-700px",right:"0",display:"block","z-index":10})),locked=!1}),$("#side-menu").metisMenu();var changeMenu=function(){var topOffset=50,width=window.innerWidth>0?window.innerWidth:screen.width;768>width?($("div.navbar-collapse").addClass("collapse"),topOffset=100):$("div.navbar-collapse").removeClass("collapse");var height=(window.innerHeight>0?window.innerHeight:screen.height)-1;height-=topOffset,1>height&&(height=1),height>topOffset&&$("#page-wrapper").css("min-height",height+"px")};$(changeMenu),$(window).resize(function(){changeMenu()})}}),BggBuddy.RootView=Ember.View.extend({afterRenderEvent:function(){var self=this;BootstrapDialog.show({title:"Sign in",message:'<div id="bggUserModal" class="form-group"><label class="control-label" for="bggUserInput">BGG user</label><input id="bggUserInput" type="text" class="form-control" id="bggUserInput" placeholder="BGG User"><div>',closable:!1,buttons:[{label:"Sign in",hotkey:13,action:function(dialogRef){dialogRef.close()}}],onhide:function(dialogRef){var bggUser=dialogRef.getModalBody().find("input").val();return 0==$.trim(bggUser.toLowerCase()).length?(dialogRef.getModalBody().find("#bggUserModal").addClass("has-error"),!1):void self.get("controller").transitionToRoute("index",$.trim(bggUser.toLowerCase()))}})}});